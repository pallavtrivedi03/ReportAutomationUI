<html>

<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- <link rel="icon" href="../../../../favicon.ico"> -->

        <title>Report Automation</title>

        <!-- Jquery core JS -->
        <script src="/javascripts/jquery-3.3.1.min.js"></script>

        <!-- Bootstrap core CSS -->
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

        <!-- Bootstrap core JS -->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

        <!-- Bootstrap datepicker  -->
        <script
                src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.css"
                rel="stylesheet">

        <!-- Custom styles -->
        <link href="/stylesheets/bi_home.css" rel="stylesheet">

        <!-- Custom font (Muli) -->
        <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">

        <!-- Helper JS -->
        <script src="/javascripts/bi_helper.js"></script>

</head>

<body>

        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
                <div class="container">
                        <a class="navbar-brand" href="#">
                                <img src="/images/Hungama.png" width="160px;" alt="">
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                                data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                                aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarResponsive">
                                <ul class="navbar-nav ml-auto">
                                        <li class="nav-item active">
                                                <a class="nav-link" href="#">Home
                                                        <span class="sr-only">(current)</span>
                                                </a>
                                        </li>
                                        <li class="nav-item">
                                                <a class="nav-link" href="#">Submissions</a>
                                        </li>
                                        <li class="nav-item">
                                                <a class="nav-link" href="#">Profile</a>
                                        </li>
                                </ul>
                        </div>
                </div>
        </nav>


        <!-- Page Content -->
        <div class="container">
                <div id="formContainer" style="background: #fff;  border-radius: 25px; margin-top: 24px;">
                        <div class="teamNameHeader">
                                <div class="row">
                                        <div class="container">
                                                <div class="col-md-3">
                                                        <h2 class="mt-2" style="margin-left: 16px;">MIS & BI</h2>
                                                </div>
                                        </div>
                                </div>
                        </div>

                        <div class="container">
                                <div class="reportUploadForm">
                                        <form method="POST" action="/landing/submitReport" id="reportSubmissionForm">
                                                <div class="row" style="margin-top:12px;">
                                                        <div class="col-md-4">
                                                                <span class="form-label">Select Label</span>
                                                                <select class="form-control" id="labelSelectControl"
                                                                        name="labelSelectControl">
                                                                </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                                <span class="form-label">Select Deals</span>
                                                                <select class="form-control" id="dealSelectControl"
                                                                        name="dealSelectControl">
                                                                        <option>NA</option>
                                                                </select>
                                                        </div>
                                                </div>

                                                <div class="row" style="margin-top:24px;">
                                                        <div class="col-md-3">
                                                                <span class="form-label">Select Client</span>
                                                                <select class="form-control" id="clientSelectControl1"
                                                                        name="clientSelectControl1">
                                                                </select>
                                                        </div>
                                                        <div class="col-md-3">
                                                                <span class="form-label">Select Service</span>
                                                                <select class="form-control" id="serviceSelectControl1"
                                                                        name="serviceSelectControl1">
                                                                        <option>CRBT</option>
                                                                </select>
                                                        </div>
                                                        <div class="col-md-3">
                                                                <span class="form-label">Select Origin</span>
                                                                <select class="form-control" id="originSelectControl1"
                                                                        name="originSelectControl1">
                                                                        <option>International</option>
                                                                </select>
                                                        </div>

                                                        <div class="col-md-2">
                                                                <button type="button" class="btn btn-info"
                                                                        id="addClientButton" style="margin-top: 32px;"
                                                                        onclick="didClickOnAddClient()">Add
                                                                        Client</button>
                                                        </div>
                                                </div>

                                                <div id="clientsContainer">
                                                        <div class="row" id="clientRow2"></div>
                                                        <div class="row" id="clientRow3"></div>
                                                </div>

                                                <div class="row" style="margin-top:24px;">
                                                        <div class="col-md-3">
                                                                <span class="form-label">Report Type</span>
                                                                <div class="radio" style="margin-top:12px;">
                                                                        <label><input type="radio" name="reportType"
                                                                                        checked>Complete</label>
                                                                        <label style="margin-left: 16px;"><input
                                                                                        type="radio"
                                                                                        name="reportType">Partial</label>
                                                                </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                                <span class="form-label">Report From</span>
                                                                <input type="text" id="fromDateField"
                                                                        name="fromDateField" class="form-control" required>
                                                        </div>
                                                        <div class="col-md-3">
                                                                <span class="form-label">Report To</span>
                                                                <input type="text" id="toDateField" name="toDateField"
                                                                        class="form-control" required>
                                                        </div>
                                                </div>

                                                <div class="row" style="margin-top:24px;">
                                                        <div class="col-md-4">
                                                                <span class="form-label">Select Report</span>
                                                                <input type="file" id="excel" name="fileName"
                                                                        class="form-control">
                                                        </div>
                                                        <div class="col-md-2">
                                                                <button type="button" class="btn btn-info"
                                                                        id="uploadButton" style="margin-top: 32px;"
                                                                        onclick="didClickOnUploadButton()">Upload
                                                                        File</button>
                                                        </div>
                                                        <div class="col-md-3">
                                                                <button type="button" class="btn btn-info"
                                                                        style="margin-top: 32px; margin-left: -32px;"
                                                                        id="previewButton"
                                                                        onclick="didClickOnPreviewButton()"
                                                                        disabled>Preview (after upload)</button>
                                                        </div>

                                                        <div class="col-md-3" style="top:38px;left: -64px;">
                                                                <div class="progress-bar progress-bar-striped active"
                                                                        id="uploadProgressBar" role="progressbar"
                                                                        aria-valuenow="50" aria-valuemin="0"
                                                                        aria-valuemax="100" style="width:0%;">
                                                                        0%
                                                                </div>
                                                        </div>
                                                </div>

                                                <div class="row" style="margin-top:42px;">
                                                        <div class="col-md-5">
                                                        </div>
                                                        <div class="col-md-2">
                                                                <button type="submit" class="btn btn-primary">Submit
                                                                        Report</button>
                                                        </div>
                                                        <div class="col-md-5">
                                                        </div>
                                                </div>
                                                <br />
                                        </form>
                                </div>
                        </div>
                </div>
        </div>
        <!-- /.container -->

        <footer id="sticky-footer" class="py-4 bg-dark text-white-50">
                <div class="container text-center">
                        <small>Copyrights &copy; 2019 Hungama Digital Media Entertainment Pvt. Ltd.</small>
                </div>
        </footer>

        <!-- The Modal -->
        <div class="modal fade" id="previewModal">
                <div class="modal-dialog modal-xl">
                        <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                        <h4 class="modal-title" id="previewModalTitle">Preview of Uploaded Report</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>

                                <!-- Modal body -->
                                <div class="modal-body">
                                        <div class="container">
                                                <table class="table table-responsive table-bordered" id="previewTable">
                                                        <thead class="thead-light">
                                                                <tr id="previewHeaderRow">
                                                                </tr>
                                                        </thead>
                                                        <tbody id="previewTableBody">

                                                        </tbody>
                                                </table>
                                        </div>
                                </div>

                                <!-- Modal footer -->
                                <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                                data-dismiss="modal">Close</button>
                                </div>

                        </div>
                </div>
        </div>

        </div>
</body>

<script type="text/javascript">
        $(document).ready(function () {

                getLabelAndClients();

                $('#fromDateField').datepicker({
                        format: 'dd/mm/yyyy'
                });
                $('#toDateField').datepicker({
                        format: 'dd/mm/yyyy'
                });

                $(document).on('change', '#labelSelectControl', function () {
                        updateDealsControl($('#labelSelectControl').val());
                });

                $(document).on('change', '#clientSelectControl1', function () {
                        updateServiceControl1($('#clientSelectControl1').val());
                });

                $(document).on('change', '#serviceSelectControl1', function () {
                        updateOriginControl1($('#clientSelectControl1').val(), $('#serviceSelectControl1').val());
                });

                //Form Submission
                $("#reportSubmissionForm").submit(function (event) {
                        event.preventDefault();

                        if (parsedReportJson === undefined) {
                                alert("You need to upload the report first.")
                                return;
                        }
                        var post_url = $(this).attr("action");
                        var request_method = $(this).attr("method");
                        var form = $(this);
                        $.ajax({
                                type: request_method,
                                url: post_url,
                                data: form.serialize(),
                                headers: {
                                        authorization: sessionStorage.getItem("token"),
                                        reportJson: parsedReportJson
                                },
                                success: function (response) {
                                        if (response.status == 200) {
                                                alert('Report submitted successfully');
                                                document.getElementById("reportSubmissionForm").reset();
                                        } else {
                                                alert(response.message);
                                        }
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                        alert("Something went wrong");
                                }
                        });
                });
        });

</script>

</html>